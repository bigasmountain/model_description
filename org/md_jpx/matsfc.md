# 境界値サブモデル MATBND

## 植生形状パラメタのセット

植生形状パラメタとして, 葉面積指数(LAI), 植生高などのセットを行う.

LAI は季節変化する水平分布を, キャノピー上端及び下端の高さは土地利用タイ プごとの値を外部パラメタとして読み込む. 積雪がある場合には, 積雪深よりも上に出ている部分の植生のみを考え, 形状パ ラメータを補正する.

    EQ=00036.
    EQ=00036.
    EQ=00036.

ここで, TERM00000 はキャノピー上端の高さ(植生高), TERM00001 はキャノピー下端 の高さ(枯れ上がり高さ), TERM00002 は葉面積指数であり, TERM00003, TERM00004, TERM00005 はそれぞれの雪の無いときの値である. TERM00006 は積雪深である. キャ ノピー上端と下端の間で LAI が鉛直一様に分布していると近似したことになっ ている.

コーディング上は, この後, 積雪面積率 TERM00007 で重み付けした無雪面と積雪 面の平均値 \[EQ=00079.\] などを求めるようになっているが, 無雪面と積雪面は別々に計算するため, TERM00008 には TERM00009 (無雪面) か TERM00010 (積雪面) のどちらかの値が入っており, 値の混合はここでは起こらないことに注意されたい (後に同様の個所が複数あ る).

## 放射パラメタの計算

放射パラメタ(アルベド, 植生透過率など)の計算を行う.

### 地表面(林床)アルベドの計算

地表面(林床)アルベド TERM00011,TERM00011 の水平分布を外部パラメタ として読み込む. TERM00012,TERM00012 はそれぞれ可視, 近赤外の波長帯を表す. また, 赤外の地表面アルベド TERM00013 を一定値にセットする(水平分布 を用意してもよい).

氷床面と積雪面については, アルベドの入射角依存性を以下の関数形により考慮 する.

    EQ=00037.

ここで, TERM00014,TERM00014 は波長帯, TERM00015,TERM00015 はそれぞれ直達, 散乱, TERM00016 は, 入射角が TERM00017 (真上から) のときのアルベドの値であ る. TERM00018 は入射角の余弦であり, 直達光と散乱光のそれぞれに 対して,

    EQ=00038.

を与える. TERM00019 は太陽天頂角である.

氷床面, 積雪面以外については, 地表面(林床)のアルベドは天頂角依存性を考え ず, 直達光と散乱光に対して同じ値を与える. すなわち以下のようである.

    EQ=00039.

また, 赤外の波長に対しては散乱光のみを考えればよい. 赤外のアルベドは全て の地表面において天頂角に依存しない値を与える.

    EQ=00040.

### キャノピーのアルベドと透過率の計算

キャノピーのアルベドと透過率の計算は, 渡辺・大谷(1995) のキャノピー層内 の放射計算に基づく.

鉛直に一様なキャノピーを考え, さらにいくつかの簡略化の仮定を置くと, キャ ノピー内の日射の伝達方程式と境界条件は以下で表される.

    EQ=00041.
    EQ=00041.
    EQ=00041.
    EQ=00041.
    EQ=00041.
    EQ=00041.

ここで, TERM00020 は下向き直達光, TERM00021 と TERM00022 はそれぞれ上向きと下向きの散乱光, TERM00023 はキャノピー上 端から下向きに積算した葉面積, TERM00024 は散光因子(TERM00025), TERM00026 と TERM00027 はそれぞれ葉面の反射率と透過率(散乱光と直達光に対して同じ 値を用いる), TERM00028 は放射に対する葉の向きを表すファクターである. ここでは簡 略化のため葉の向きの分布はランダム(TERM00029)とする.

これらは解析的に解くことができ, 解は以下のようになる.

    EQ=00042.
    EQ=00042.
    EQ=00042.

ここで,

    EQ=00043.
    EQ=00043.
    EQ=00043.
    EQ=00043.
    EQ=00043.
    EQ=00043.
    EQ=00043.
    EQ=00043.

である.

キャノピー上端で見たアルベド TERM00030 は,

    EQ=00044.

であるから,

    EQ=00045.
    EQ=00045.

を得る.

また, キャノピーの透過率 TERM00031 (正確には, キャノピー上端の入射光 のうち林床が吸収する割合)を

    EQ=00046.

で定義すると,

    EQ=00047.
    EQ=00047.
    EQ=00047.
    EQ=00047.

を得る. 以上を TERM00032,TERM00032 (可視と近赤外) についてそれぞれ行う.

葉面の反射率 TERM00033 と透過率 TERM00034 は, 土地被覆タイプごとの外部パラメタとし て読み込むが, 上記の計算に用いる前に以下の２つの修正を行う.

1.  葉面上の雪(氷)の効果  
    キャノピー温度が 0 TERM00035 C 以下の場合, キャノピー上水分を雪(氷)と見な す. このとき, 雪のアルベド TERM00036 とキャノピー上水分量 TERM00037 を用いて,
    
        EQ=00048.
        EQ=00048.
    
    とする. TERM00038 はキャノピー上水分容量である. 透過率については, 吸収率 (TERM00039) が負にならないように, 便宜的に
    
        EQ=00000.
    
    とする. キャノピー上水分が液体のときには, それによる葉面の放射パラメタの変化は 無視する. また, キャノピーが降雪を捕捉した場合(雪)と, キャノピー上の液体水が凍っ た場合(氷)が考えられ, それぞれの放射特性は異なるであろうが, ここでは全 て林床の積雪と同じアルベドを用いる.

2.  反射・透過の向きを考慮する効果  
    上述の方程式の解では, 反射光は全て入射して来た向きに戻ることが仮定され ているが, 例えばその一部が入射光と同じ向きに散乱されることを考慮すると, 葉面の放射パラメタを以下のように置き換えればよい (渡辺, 私信).
    
        EQ=00049.
        EQ=00049.

以上は TERM00040,TERM00040 (可視と近赤外) についてそれぞれ行う.

また, 植生がグリッドの一部に偏在している場合(サバンナなど)を考慮して, ア ルベドなどの計算に先立って,

    EQ=00001.

として, 植生被覆部分の LAI (もとの LAI はグリッド平均値と考えて) を求め, これを前述のアルベドなどの計算に用いる. TERM00041 はグリッド中の植生被覆率である. アルベドなどが求まった後に,

    EQ=00050.
    EQ=00050.

のように, 植生被覆部分と非植生被覆部分の面積重み付け平均を取る.

### 地表面放射フラックスなどの計算

地表下向き放射フラックス TERM00042 と上で求めたアルベドな どを用いて, 以下の放射フラックスを求める.

    EQ=00051.
    EQ=00051.
    EQ=00051.
    EQ=00051.
    EQ=00051.

ここで, TERM00043, TERM00044 はそれぞれ下向き及び上向き の短波放射フラックス, TERM00045 は下向き長波放射フラックス, TERM00046 は林床が吸収する短波放射フラックス, TERM00047 は下向き光合成有効 放射(PAR)フラックスである.

また, 短波と長波のキャノピー透過率および長波の射出率を以下のように求める.

    EQ=00052.
    EQ=00052.
    EQ=00052.

## 乱流パラメタ(バルク係数)の計算

乱流パラメタ(バルク係数)の計算を行う.

### 運動量と熱に対する粗度の計算

粗度の計算は, Watanabe(1994)に基づく. Watanabe(1994) では, Kondo and Watanabe(1992) の多層キャノピーモデルの結果を用いて, それにベストフィッ トするバルクモデルの粗度の関数形として以下を提案している.

    EQ=00053.
    EQ=00053.
    EQ=00053.
    EQ=00053.
    EQ=00053.
    EQ=00053.
    EQ=00053.
    EQ=00053.
    EQ=00053.
    EQ=00053.
    EQ=00053.
    EQ=00053.

ここで, TERM00048, TERM00049 はそれぞれ運動量および熱に対するキャノピー全体の粗 度, TERM00050, TERM00051 はそれぞれ運動量および熱に対する地表面(林床)の粗度, TERM00052, TERM00053 はそれぞれ運動量および熱に対する個葉と大気の間の交換係数, TERM00054 は植生高, TERM00055 はゼロ面変位, TERM00056 は LAI である. TERM00057 は葉面における熱の出入りが無いとした場合の熱に対する粗度 であり, 林床からの熱の輸送係数を求める際に用いられる.

TERM00058 および TERM00059 は, 土地被覆タイプごとの外部データとして与えられる が, 標準では土地被覆タイプによらず一定値 (TERM00060 m, TERM00061 m ) を与えている. ただし, 積雪面については以下の修正を施す.

    EQ=00054.
    EQ=00054.
    EQ=00054.

ここで, TERM00062 は積雪深, TERM00063, TERM00064 は, それぞれ運動量と熱に 対する積雪面の粗度である.

TERM00065 および TERM00066 は葉の形状により決まるパラメタであり, 土地被覆タイプ ごとの外部データとして与える.

### 運動量と熱に対するバルク係数の計算

バルク係数も Watanabe(1994)にならい, Monin-Obukhov の相似則を用いて, 以 下のように求める.

    EQ=00055.
    EQ=00055.
    EQ=00055.
    EQ=00055.

ここで, TERM00067, TERM00068 はそれぞれ運動量と熱に対するキャノピー全体(葉面 TERM00069 林床)のバルク係数, TERM00070 は熱に対する地表面(林床)フラックスのバルク係 数, TERM00071 は熱に対するキャノピー(葉面)フラックスのバルク係数, TERM00072, TERM00073 はそれぞれ運動量と熱に対する Monin-Obukhov のシア関数, TERM00074 は大気の参照高度(大気第１層の高度)である. TERM00075, TERM00076 は, それぞれキャノピー全体および地表面(林床)に関する Monin-Obukhov 長 TERM00077, TERM00078 を用いて,

    EQ=00056.
    EQ=00056.

で表される. また, Monin-Obukhov 長は,

    EQ=00057.
    EQ=00057.

で表される. ここで, TERM00079 =300K, TERM00080 は地表面風速の絶対値, TERM00081 はカルマン 定数, TERM00082 は重力加速度, TERM00083, TERM00084, TERM00085 はそれぞれ大気第１層, キャノ ピー(葉面)および地表面(林床)の温度である.

Monin-Obukhov 長の計算にはバルク係数が必要であり, バルク係数の計算には Monin-Obukhov 長が必要であるため, 中立のバルク係数を初期値として, 繰り返 し計算(標準では2回)を行う.

また, 積雪面においては, この計算に先立って, ゼロ面変位には積雪深を加えて おく, ただし, ゼロ面変位が TERM00086 に比べて大きくなり過ぎないように, 上限を 設ける.

    EQ=00058.

標準では TERM00087 を 0.5 に取っている.

### 水蒸気に対するバルク係数の計算

この計算は, 後に述べる気孔抵抗の計算を行った後に行う.

気孔抵抗 TERM00088, 地表面蒸発抵抗 TERM00089 が求まったら, 水蒸気に対す るバルク係数を以下のように求める.

    EQ=00059.
    EQ=00059.

(以前は, 気孔抵抗などを交換係数の減少に換算して, 粗度を経由して求めてい たが, 問題がありそうなので簡便な方法に改めた)

なお, 気孔抵抗などのかからない場合(濡れた面からの蒸発など)は, 水蒸気のバ ルク係数は熱のバルク係数と同じものを使う.

## 気孔抵抗の計算

気孔抵抗の計算は, Farquhar et al.(1980), Ball(1988), Collatz et al.(1990, 1991, 1992) などに基づく光合成-気孔モデルを用いている. キャノピー全体の抵抗を求める方法を除いて, SiB2 (Sellers et al., 1996) の コードをほぼそのまま使っている. Jarvis 型の経験式をこれの代わりに用いることもできるが, ここではその説明 は略す.

### 土壌水分ストレスファクターの計算

蒸散に対する土壌水分ストレスを求める. 土壌各層の土壌水分ストレスファクターを求め, 各層の根の分布で重み付けして 土壌全体のストレスファクターを計算する.

各層の土壌水分ストレスは, SiB2 (Sellers et al., 1996) を参考に, 以下の式 により評価する.

    EQ=00002.

土壌全体のストレスファクターは,

    EQ=00003.

ここで, TERM00090 は各層の根の存在比率で, 土地被覆タイプごとの外部パ ラメタである. TERM00091 である.

さらに, 蒸散量を各層の根の吸い上げフラックスに分配する重みを以下のように おく.

    EQ=00004.

ここで, TERM00092 であることに注意されたい.

### 光合成量の計算

SiB2 (Sellers et al., 1996) にならって, 光合成量の計算を行う.

光合成量は, ３つの上限によって規定されていると考える.

    EQ=00005.

TERM00093 は光合成酵素(Rubisco)の効率による上限, TERM00094 は光合成有効放射量による上限である. TERM00095 は TERM00096 植物の場合は光合成生成物の利用効率(シンク)による上限, TERM00097 植物の場合は TERM00098 濃度による上限である (Collatz et al., 1991, 1992).

それぞれの大きさは以下のように見積もられる.

    EQ=00060.
    EQ=00060.
    EQ=00060.

ここで, TERM00105 は Rubisco 反応容量, TERM00106 は気孔内における TERM00107 の分圧, TERM00108 は気孔内における酸素の分圧, TERM00109 は光合成有効放射量(PAR)である. TERM00110 は TERM00111 補償点で, TERM00112 で表される. TERM00113, TERM00114, TERM00115 は温度の関数であり, 後で関数形を示す. TERM00116, TERM00117 は, 植生タイプによって決まる定数である.

(76) は, 実際には, 異なる上限の間の滑らかな遷移を表すために, 以下のように解かれる.

    EQ=00061.
    EQ=00061.

それぞれの方程式について２つの解のうち小さいほうを選びながら, ２つの方程 式を順に解くと, TERM00118 が得られる. TERM00119,TERM00119 は植生タイプによって決まる定数である. TERM00120 のときに単純な最小値操作と一致することに注意されたい.

光合成量が求まったら, 純光合成量 TERM00121 を以下のように求める.

    EQ=00006.

TERM00122 は呼吸量であり, 以下で表される.

    EQ=00007.

TERM00123 は植生タイプによって決まる定数である.

TERM00124 などは温度と土壌水分に以下のように依存する (TERM00125 は, 現れる項 によって温度依存性が異なるが, 同じ TERM00126 で表した).

    EQ=00062.
    EQ=00062.
    EQ=00062.
    EQ=00062.
    EQ=00062.
    EQ=00062.

ここで, TERM00138, TERM00139,TERM00139 は, 植生タイプによって決まる定数で ある.

以上で, TERM00140, TERM00141, TERM00142, TERM00143, TERM00144 が与えられれば, 個葉におけ る光合成量が計算できる. 現実には, これらの値は同じキャノピー内でもばらつきを持って分布していると 考えられるが, ここでは, TERM00145, TERM00146, TERM00147 は全ての葉について同じと近似 し, TERM00148 と TERM00149 については鉛直の分布を考慮する. TERM00150 はキャノピー上端で大きく, 下に行くほど減衰するが, TERM00151 につい ても, この TERM00152 の分布に順応して, TERM00153 と類似の分布をとると考えられる.

平均的な TERM00154 の鉛直分布(したがって TERM00155 の鉛直分布)を以下のように 表す.

    EQ=00008.

ここで, TERM00156 はキャノピー上端から積算した葉面積, TERM00157 はキャノピー 上端での TERM00158, TERM00159 は(17)で定義した減衰係数, TERM00160 は調節の ための定数である. これを用いて, 平均的な TERM00161 の値を表すファクター TERM00162 を以下で定義 する.

    EQ=00009.

TERM00163 を構成する各項(TERM00164,TERM00164) は, いずれも TERM00165 もしくは TERM00166 に比例するため, TERM00167 と TERM00168 の鉛直分布が比例するとの前提に立 てば, キャノピー上端の TERM00169 と TERM00170 の値を使って求めた TERM00171 に, TERM00172 を掛けることによって, 平均的な葉の光合成量 TERM00173 を求 めることができる.

    EQ=00010.

以下では, これを改めて TERM00174 と呼ぶ.

### 気孔抵抗の計算

純光合成量 TERM00175 と 気孔コンダクタンス TERM00176 は, Ball (1988) の準経験的な 式により以下のように関係付ける.

    EQ=00011.

ここで, TERM00177 は葉面における TERM00178 モル分率(空気 1mol あたりの TERM00179 の mol 数), TERM00180 は土壌水分ストレスファクター, TERM00181 と TERM00182 は植生タイプによっ て決まる定数である.

TERM00183 は葉面における相対湿度で, 以下で定義される.

    EQ=00012.

TERM00184 は葉面における水蒸気モル分率, TERM00185 は気孔内の水蒸気モル分率であり, TERM00186 である. TERM00187 は 飽和水蒸気量のモル分率を表す.

気孔内から葉面への水蒸気フラックスと, 葉面から大気中への水蒸気フラックス が等しい(葉面で水蒸気の収束発散が無い)とおけば,

    EQ=00013.

より,

    EQ=00014.

を得る. ここで, TERM00188 は大気中水蒸気モル分率, TERM00189 は葉面から大気の間の コンダクタンスである. TERM00190 は, バルク係数を用いて TERM00191 で表す.

同様に, 葉面で TERM00192 の収束発散が無いと考えれば,

    EQ=00015.

より,

    EQ=00063.
    EQ=00063.

を得る. ここで, TERM00193, TERM00194 はそれぞれ大気中および気孔内の TERM00195 モル 分率である. 1.4 と 1.6 は, 水蒸気と TERM00196 の拡散係数の違いにより現れる 定数である.

(93)に (94), (96) を代入して整理すると, 以下の TERM00197 の方程式を得る.

    EQ=00016.

ただし,

    EQ=00017.

であり, TERM00198 には (99) を用いる.

(100) の２つの解のうち, 大きいほうが意味のある解である. 以上から, TERM00199 を既知とすれば TERM00200 を解くことができたが, TERM00201 を求め る際に TERM00202 を用いている. TERM00203 は, TERM00204 が求まれば (99) により求まる. つまり, TERM00205 を求めるには TERM00206 が必要, TERM00207 を求めるには TERM00208, すな わち TERM00209 が必要であるので, 繰り返し計算を行う必要がある.

繰り返し計算のアルゴリズムは SiB2 から移植したもので, ６回の繰り返しを行 い, 誤差を大きい順に並べて次の解を推定することにより収束を早める手法を用 いている.

最後に, 気孔コンダクタンスを用いて, 気孔抵抗は以下で表される.

    EQ=00018.

### 地表面蒸発抵抗の計算

地表面蒸発抵抗 TERM00210 と土壌第１層の相対湿度 TERM00211 を以下のように計 算する.

    EQ=00064.
    EQ=00064.

ここで, TERM00212 は土壌第１層の飽和度, TERM00213 は土壌第１層の水分ポテンシャル, TERM00214 は重力加速度, TERM00215 は空気の気体 定数, TERM00216 は土壌第１層の温度である. TERM00217, TERM00218 は定数で, 標準では TERM00219, TERM00220=0.2 を用いている.

# 地表サブモデル MATSFC

## 地表乱流フラックスの計算

バルク法により地表面での乱流フラックスを以下のように求める. 後に地表のエネルギーバランスを解いて, 地表面温度 TERM00221, キャノピー温度 TERM00222 が更新されると, その値に対して地表面フラックスの値も更新される. ここで求めるのはそれまでの暫定的な値である. また, エネルギーバランスを TERM00223 と TERM00224 について線形化して解くために, 各フ ラックスの TERM00225 と TERM00226 についての微分を計算しておく.

  - 運動量フラックス
    
        EQ=00065.
        EQ=00065.
    
    ここで, TERM00227, TERM00228 は, それぞれ東西, 南北方向の運動量フラックス (地表面ストレス)である.

  - 顕熱フラックス
    
        EQ=00066.
        EQ=00066.
        EQ=00066.
        EQ=00066.
    
    ここで, TERM00229, TERM00230 はそれぞれ地表面(林床)およびキャノピー(葉面)からの 顕熱フラックス, TERM00231, TERM00232 は空気の気体定数, TERM00233 は空気の比熱である.

  - 裸地面(林床)蒸発フラックス
    
        EQ=00067.
        EQ=00067.
        EQ=00067.
        EQ=00067.
    
    ここで, TERM00234, TERM00235 はそれぞれ裸地面での水の蒸発および氷 の昇華フラックス, TERM00236 は地表面温度における飽和比湿, TERM00237 は 土壌表層の相対湿度, TERM00238 は積雪面積率, TERM00239 は土壌第１層の氷の 割合
    
        EQ=00019.
    
    である. 無雪面と積雪面は別々に計算するため, TERM00240 には TERM00241 (無雪面) か TERM00242 (積雪面) のどちらかの値が入っていることに注意. また, フラックスが下向き(結露)の場合には土壌水分の抵抗はかからないので, バ ルク係数は以下のように取る.
    
        EQ=00020.

  - 蒸散フラックス
    
        EQ=00068.
        EQ=00068.
        EQ=00068.
        EQ=00068.
    
    ここで, TERM00243, TERM00244 は水および氷の蒸散であるが, TERM00245 は常にゼロである. TERM00246 はキャノピーの濡れ面積率である. フラックスが下向きの場合には, 葉の乾いた部分への結露と考えて, バルク係数 を以下のように取る.
    
        EQ=00021.

  - キャノピー上蒸発フラックス  
    TERM00247 TERM00248 0 TERM00249 C のとき
    
        EQ=00069.
        EQ=00069.
        EQ=00069.
        EQ=00069.
    
    TERM00250 TERM00251 0 TERM00252 C のとき
    
        EQ=00070.
        EQ=00070.
        EQ=00070.
        EQ=00070.
    
    ここで, TERM00253, TERM00254 はキャノピー上の水の蒸発および氷の昇 華である.

  - 積雪昇華フラックス
    
        EQ=00071.
        EQ=00071.
    
    TERM00255 は積雪昇華フラックスである. 無雪面と積雪面は別々に計算するため, TERM00256 には TERM00257 (無雪面) か TERM00258 (積雪面) のどちらかの値が入っていることに注意.

## 熱伝導フラックスの計算

無雪面および積雪面上の熱伝導フラックスを計算する. 乱流フラックスと同様, 後にエネルギーバランスを解いて地表温度が更新されると, その値に対して熱伝 導フラックスの値も更新される.

なお, 無雪面と積雪面は別々に計算するため, 以下で積雪面積率 TERM00259 には TERM00260 (無雪面) か TERM00261 (積雪面) のどちらかの値が入っていることに注意.

  - 無雪面の熱伝導フラックス
    
        EQ=00072.
        EQ=00072.
    
    ここで, TERM00262 は熱伝導フラックス, TERM00263 は土壌の熱伝導率, TERM00264 は土壌第１層の温度の定義点から地表面までの厚さ, TERM00265 は土壌第１層の温度である.

  - 積雪面の熱伝導フラックス
    
        EQ=00073.
        EQ=00073.
    
    ここで, TERM00266 は熱伝導フラックス, TERM00267 は積雪の熱伝導率, TERM00268 は積雪第１層の温度の定義点から地表面までの厚さ, TERM00269 は積雪第１層の温度である.

## 地表面, キャノピーエネルギーバランスの求解

エネルギーバランスは, 1:地表面の融解が無い場合, 2:地表面の融解がある場合, の 2ケースについて解く. ケース 2では, 地表温度 TERM00270 を TERM00271 Cに 固定して解き, エネルギーバランスから融解に利用できるエネルギーを診断する. 植生上の融雪は後で補正により処理するため, ここでそのケースを別に解くことは しない. また, 積雪が時間ステップ内に融けきってしまう場合についても後で 補正により処理する.

### 地表, キャノピーエネルギーバランス

地表面(林床)におけるエネルギーの発散量は,

    EQ=00022.

ただし, TERM00272, TERM00273 はそれぞれ蒸発と昇華の潜熱, TERM00274 は地表面における正味の放射発散量で,

    EQ=00023.

TERM00275 は Stefan-Boltzman 定数である.

キャノピー(葉面)におけるエネルギーの発散量は,

    EQ=00024.

ただし, TERM00276 はキャノピーにおける正味の放射発散量で,

    EQ=00025.

### ケース１: 地表面の融解が無い場合

地表面の融解が無い場合, TERM00277 として, 地表 面とキャノピーのエネルギーバランスが成り立つように, TERM00278, TERM00279 を解く.

TERM00280, TERM00281 について各項を線形化したエネルギーバランスの式は,

    EQ=00026.

と書ける.

右辺の TERM00282 の付いた部分が, 前のステップの TERM00283, TERM00284 の値を用いて (107)から (134) で計算したフラックスを (136)から(139)に代入したものである.

微分項は,

    EQ=00074.
    EQ=00074.
    EQ=00074.
    EQ=00074.

ただし,

    EQ=00075.
    EQ=00075.
    EQ=00075.
    EQ=00075.

以上を用いて, (140) を TERM00285, TERM00286 について解けばよい.

### ケース２: 地表面の融解がある場合

地表面に積雪があるか土地被覆タイプが氷床であり, かつケース１で解いてみた 地表面温度 TERM00287 が0 TERM00288 C よりも 高い場合, 地表面の融解が生じる. 地表面の融解がある場合には, 地表温度は 0 TERM00289 C に固定される. すなわち,

    EQ=00027.

である. TERM00290 は氷の融点 (0 TERM00291 C) である.

TERM00292 は, TERM00293 を既知として, (140) と同様に以下の式で求め る.

    EQ=00028.

こうして TERM00294 と TERM00295 が既知になれば, 融解に使われる地表 面のエネルギー収束量は,

    EQ=00029.

により求まる.

### 解の制約条件

地表面エネルギーバランスの解にいくつかの制約条件を設ける. 解いてみて, もしも条件を破っていれば, 条件を破ったフラックスを条件を満た す限界の値に固定して, エネルギーバランスを解きなおす.

1.  大気第１層の水蒸気を取り過ぎない  
    一時的な計算不安定により, 大きな下向きの潜熱が生じてしまうことがありう る. そのような場合でも地表面から大気第１層までの水蒸気をすべて奪わないよう に条件を付ける.
    
        EQ=00076.
        EQ=00076.
    
    ここで, TERM00296 は重力加速度, TERM00297 は大気モデルの時間ステップである. 判定に用いる TERM00298 などの値には, エネルギーバランスを満たすように更新し た TERM00299, TERM00300 の値に対して更新したフラックスの値(TERM00301)を用いる. これは以下の他の条件の場合でも全て同じである. フラックスの値の更新については後に述べる.

2.  土壌水分が負にならない  
    蒸散によって土壌水分が負にならないようにする.
    
        EQ=00030.
    
    ここで, TERM00302 は水の密度, TERM00303 は陸面モデルの時間ステップで ある.

3.  キャノピー上水分が負にならない  
    キャノピー上水分が蒸発によって負にならないようにする.
    
        EQ=00031.

4.  積雪量が負にならない  
    積雪の昇華によって積雪量が負にならないようにする.
    
        EQ=00032.

### 地表面, キャノピー温度の更新

地表面温度とキャノピー温度を更新する.

    EQ=00077.
    EQ=00077.

更新されたキャノピー温度をもとに, キャノピー上水分が液体か固体かを診断 しておく. この情報は後にキャノピー上水分の凍結融解を扱うときに使う.

    EQ=00033.

TERM00304 は, キャノピー上水分の凍結面積率である.

### フラックスの値の更新

更新した TERM00305, TERM00306 の値に対してフラックスの値を更新する. TERM00307 を任意のフラックスとすれば, 値の更新は以下のように行う.

    EQ=00034.

更新したフラックスの値を用いて, 大気に出力するフラックスなどを計算する.

    EQ=00078.
    EQ=00078.
    EQ=00078.
    EQ=00078.

TERM00308 は地表面の放射温度である.

また, 土壌各層の根の吸い上げフラックスを計算する.

    EQ=00035.

TERM00309 は根の吸い上げフラックス, TERM00310 は蒸散量を各層の 根の吸い上げフラックスに分配する重みである.
