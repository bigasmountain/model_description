\section{積雪サブモデル MATSNW}

積雪量, 積雪温度, 積雪アルベドの計算を行う.

\subsection{積雪面積率の診断}

積雪が少量の場合には, サブグリッドの積雪を考慮する.
積雪面積率 TERM00000 は, 積雪量 TERM00001 の一意な関数として,
\begin{verbatim}
EQ=00000.
\end{verbatim}
で与える. 標準では TERM00002=100 [kg/TERM00003] である.

実際には, 地形や降雪時/融雪時の違いなど, 様々な要因が積雪面積率に影響を
与えると考えられる.
これについては Liston (私信) によるサブグリッド積雪分布モデル(SSNOWD) の
導入を検討中である.

TERM00004 は, フラックス計算部の冒頭で参照され, そこで計算された種々のフ
ラックスを以下のように面積重み付け平均するのに用いられる.
\begin{verbatim}
EQ=00001.
\end{verbatim}
ここで, TERM00005, TERM00006 はそれぞれ無雪面, 積雪面でのフラックスであ
る. 実際にはこの操作はフラックスカプラーを通して行われる.

\subsection{積雪層の鉛直分割}

積雪温度の鉛直分布を表現するため, 積雪量が多い場合には積雪を多層に分割し
て各層で温度を定義する.
積雪層数は可変とし, 積雪量が増えるに従って層数を増やす. 標準では最少１層,
最大３層である.

層数および各層の質量は, 積雪量により一意に決まるようにする. これにより,
各層の質量は新たな予報変数にならない.

標準では, 各層の質量 TERM00007,TERM00007 は以下のように決める
(TERM00008 が最上層である).
\begin{verbatim}
EQ=00038.
EQ=00038.
EQ=00038.
\end{verbatim}
ここで,
\begin{verbatim}
EQ=00002.
\end{verbatim}
であり, TERM00009 がグリッド平均の積雪量であるのに対して, TERM00010 は
積雪域の積雪量である.
各層の質量 TERM00011 も積雪域の値であり, グリッド平均
値では無いことに注意されたい.
また, 単位は kg/TERM00012 である.

上記から明らかであるが, 積雪層数 TERM00013 は標準では以下のようになる.
\begin{verbatim}
EQ=00003.
\end{verbatim}

\subsection{積雪量の計算}

積雪量の予報方程式は以下で与えられる.
\begin{verbatim}
EQ=00004.
\end{verbatim}
TERM00014 は, キャノピーによる遮断を経た降雪フラックス, TERM00015 は昇華
フラックス, TERM00016 は融雪, TERM00017 は融雪水の再凍結または降雨の凍結で
ある.

\subsubsection{積雪の昇華}

まず, 昇華量を差し引いて, 積雪量を部分的に更新する.
\begin{verbatim}
EQ=00039.
EQ=00039.
\end{verbatim}
万が一, 昇華量が第１層目の積雪量よりも大きい場合には, 残りを一つ下の層から
差し引く. これにより第２層目が足りなくなった場合も同様である.

\subsubsection{積雪の融解}

次に積雪中の熱伝導を計算し, 融雪量を求める.
積雪中の熱伝導の計算方法は後で述べる.
熱伝導により更新された積雪温度を TERM00018 とする.
温度を計算して, 積雪第１層の温度が
TERM00019 Cよりも高くなった場合には, 第１層の温度を
TERM00020 に固定して計算をやり直す. その場合, 第１層目にはエネルギー収
束 TERM00021 が計算されている. これはグリッド平均値
ではなく, 積雪域の値である.
第１層の融雪量は,
\begin{verbatim}
EQ=00005.
\end{verbatim}
である.

第２層目以下に関しては, 温度が TERM00022 よりも高ければ, TERM00023 に戻し,
その温度変化分の内部エネルギーを融雪に使う.
すなわち,
\begin{verbatim}
EQ=00006.
\end{verbatim}
とし, TERM00024 を新たに
\begin{verbatim}
EQ=00007.
\end{verbatim}
で定義し, (11) と同様に融雪量を求める.

融雪量を差し引いて各層の質量を更新する.
\begin{verbatim}
EQ=00008.
\end{verbatim}

これらの計算の途中で, ある層が全て融解した場合には,
TERM00025 の残りは一つ下の層に与えられ,
一つ下の層の温度を上昇させる. すなわち,
\begin{verbatim}
EQ=00009.
\end{verbatim}
\begin{verbatim}
EQ=00010.
\end{verbatim}
ここで, TERM00026 は雪(氷)の比熱である.
また, 積雪が全て融解した場合には,
 TERM00027 は土壌に与えられる.

積雪全体の融雪量は, 各層の融雪量の和である(ただし, グリッド平均値である
ことに注意).
\begin{verbatim}
EQ=00011.
\end{verbatim}
融雪量を差し引いて, 積雪量を部分的に更新する.
\begin{verbatim}
EQ=00012.
\end{verbatim}

\subsubsection{積雪中での融雪水と降雨の凍結}

融雪水と降雨の積雪中での凍結を計算する.
融雪水については, 上の層の融雪で生じた液体水が下の層で再凍結する効果を考
慮するものである.
積雪中に保持されている液体水分量は考慮せず, 全て積雪中で凍結するか積雪の
下に流れ落ちるかのどちらかとして扱う.

積雪域における, 積雪上端での液体水フラックスは,
\begin{verbatim}
EQ=00013.
\end{verbatim}
ここで, 積雪の第２層目以下で融解した分も, 積雪上端から流すことにする.
(実際問題としては, 第２層目以下で融雪が起こることは少ない)

融雪水の温度は 0 TERM00028 C と考えて妥当と思われるが, 積雪上への降雨の温
度も便器的に 0 TERM00029 C と仮定する.
水の凍結の潜熱によって積雪の温度は上昇するが, ある層の積雪の温度が
0 TERM00030 C まで上昇したら, それ以上の水は凍結できず, 一つ下の層に流れ
るとする. また, それ以外にも, その層の積雪の質量に比べてある割合しか凍結
できないとする上限を設ける. すなわち, ある層での凍結量 TERM00031 は,
\begin{verbatim}
EQ=00014.
\end{verbatim}
により求める.
TERM00032 は積雪の第 TERM00033 層目の上端から流れ込む液体水フラックスである.
TERM00034 は標準では 0.1 とする.

積雪の温度変化は,
\begin{verbatim}
EQ=00015.
\end{verbatim}
と更新し, また, 質量を
\begin{verbatim}
EQ=00016.
\end{verbatim}
と更新する.

積雪全体の凍結量は, 各層の凍結量の和である(ただし, グリッド平均値である).
\begin{verbatim}
EQ=00017.
\end{verbatim}
凍結量を加えて, 積雪量を部分的に更新する.
\begin{verbatim}
EQ=00018.
\end{verbatim}

積雪を下まで通過した液体水は, 土壌に与えられる.

\subsubsection{降雪}

最後に, キャノピーによる遮断を経た降雪量を加えて, 最終的に更新された積雪
量を得る.
\begin{verbatim}
EQ=00040.
\end{verbatim}

ただし, 土壌第１層の温度が TERM00035 C 以上の場合には, 降雪は地面で融け
るとする. この場合, 融解の潜熱の分のエネルギーは土壌から奪う.

今まで積雪が存在しなかったグリッドに降雪により積雪が生じた場合, ここで新
たに(1)により, 積雪面積率 TERM00036 を診断するとともに, 積雪
温度 TERM00037 は土壌第１層の温度と等しいと仮定する.

また, 第１層の質量に降雪量を加える.
\begin{verbatim}
EQ=00019.
\end{verbatim}

\subsubsection{積雪層の再分割と温度の再診断}

積雪量が更新された時点で, 積雪面積率を(1)により再診断し, 各
層の質量を (3)TERM00038(5) により再分割する.
再分割された各層の温度は, エネルギーが保存するように診断しなおす.
\begin{verbatim}
EQ=00020.
\end{verbatim}
ただし, TERM00039 の添え字の付いたものは再分割前, TERM00040 の添え字の付いたもの
は再分割後の変数である.
TERM00041 は, 再分割前の TERM00042 層目の質量のうち, 再分割後
の TERM00043 層目に含まれている割合である.

\subsection{積雪中の熱伝導の計算}

\subsubsection{積雪中の熱伝導方程式}

積雪中の熱伝導による積雪温度の予報方程式は以下のようである.
\begin{verbatim}
EQ=00021.
\end{verbatim}

ここで, 熱伝導フラックス TERM00044 は以下で与えられる.
\begin{verbatim}
EQ=00022.
\end{verbatim}
TERM00045 は積雪の熱伝導率であり, 標準では 0.3 W/m/K の一定値を
与えている. TERM00046 は積雪各層の厚さであり,
\begin{verbatim}
EQ=00023.
\end{verbatim}
で定義される. TERM00047 は積雪の密度であり, 標準では 300 kg/TERM00048 の一
定値を与えている.
積雪の密度や熱伝導率は, 時間が経つにつれて圧密や変質により変化する
(aging) と考えられるが, ここではその効果は考慮していない.

(29)において,
積雪上端のフラックス TERM00049 は, 地表面エネルギーバラン
スのところで求めた積雪から地表面への熱伝導フラックス TERM00050, 地表
面温度を融雪条件で解いた場合に生じた地表エネルギー収束 TERM00051, およびキャノピー上水分の相変化があった場合に生じたエネルギー
補正 TERM00052 を用いて与えられている.
TERM00053 は積雪面上のみに, TERM00054 はグリッドに一様
に与えられるとした. フラックスの符号を上向き正に取るので, 収束量に負号が
付く.

また, 積雪下端のフラックス TERM00055 の式にお
いて, TERM00056 は, 積雪下端(積雪と土壌の境界面)の温度である.
ところが, 土壌第１層から積雪下端へのフラックスは
\begin{verbatim}
EQ=00024.
\end{verbatim}
であるから, 積雪下端でフラックスの収束が無いと仮定し,
\begin{verbatim}
EQ=00025.
\end{verbatim}
と置くことにより, TERM00057 が求まり, これを(33) に代入
して以下を得る.
\begin{verbatim}
EQ=00026.
\end{verbatim}

\subsubsection{ケース1:第１層目で融雪が起こらない場合}

積雪第１層から最下層の温度に関して, 陰解法を用いる.
すなわち,
\begin{verbatim}
EQ=00027.
\end{verbatim}
\begin{verbatim}
EQ=00028.
\end{verbatim}
\begin{verbatim}
EQ=00029.
\end{verbatim}
\begin{verbatim}
EQ=00030.
\end{verbatim}
と置いて, (28) を
\begin{verbatim}
EQ=00041.
EQ=00041.
EQ=00041.
\end{verbatim}
のように扱い, TERM00058,TERM00058 についての
TERM00059 本の連立方程式として LU 分解法により解く.
この際, 積雪上端のフラックスは境界条件として固定していること, 積雪下端の
境界条件は土壌第１層温度であり, 積雪下端フラックスは土壌第１層温度に関し
ては陽解法的に扱うことに注意されたい.
\begin{verbatim}
EQ=00031.
\end{verbatim}
により積雪温度を部分的に更新する.

\subsubsection{ケース2:第１層目で融雪が起こる場合}

ケース1で解いてみた積雪第１層の温度が TERM00060 C よりも高い場
合, 積雪第１層で融雪が生じる. この場合, 積雪第１層温度は TERM00061 Cに
固定される. すなわち, 積雪第２層目から第１層目へのフラックスを
\begin{verbatim}
EQ=00032.
\end{verbatim}
のように置いて, ケース1と同様に解く
(積雪が１層しか無い場合には, 土壌から積雪へのフラックスにおいて, 同様に
積雪温度を固定する).

積雪第１層の融解に使われるエネルギー収束は以下で与えられる.
\begin{verbatim}
EQ=00033.
\end{verbatim}

積雪第２層目以下の温度が TERM00062 よりも高くなっても解き直しは行わず,
補正的に融雪を処理する.

\subsection{氷河の生成}

積雪量に最大値を設け, 最大値を越えた分は氷河となって流出すると考える.
\begin{verbatim}
EQ=00034.
\end{verbatim}
\begin{verbatim}
EQ=00042.
EQ=00042.
\end{verbatim}
TERM00063 は氷河流出量である. この分の質量は積雪の最下層から差し引く.
TERM00064 は標準では一律に 1000 kg/TERM00065 で与える.

\subsection{土壌もしくは流出過程へ与えられるフラックス}

積雪過程を経てへ土壌へ与えられる熱フラックスは以下である.
\begin{verbatim}
EQ=00035.
\end{verbatim}
TERM00066 は積雪が全て融雪した場合に残ったエネルギー
収束, TERM00067 は積雪最下層の熱伝導フラックス,
TERM00068 は, 地面に到達してすぐに融けた降雪量である.

また, キャノピー上水分の相変化によるエネルギー補正項は, 無積雪面の分が土
壌にそのまま与えられるため, 以下のようになる.
\begin{verbatim}
EQ=00036.
\end{verbatim}

積雪過程を経て流出過程へ与えられる水フラックスは以下である.
\begin{verbatim}
EQ=00043.
EQ=00043.
\end{verbatim}
TERM00069 は, 積雪最下層を通過した降雨もしくは融雪水のフラッ
クスである.

\subsection{積雪アルベドの計算}

積雪のアルベドは, 新雪では大きいが, 圧密, 変質や汚れの付着によって時間が
経つにつれて小さくなる. この効果を考慮するため, 積雪のアルベドを予報変数
として取り扱う.

積雪の「古さ」(age) の時間発展は, Wiscombe and Warren (1980) にならい,
以下の式に従うとする.
\begin{verbatim}
EQ=00037.
\end{verbatim}
TERM00070 = 5000, TERM00071 = 1 TERM00072 10 TERM00073 である.
TERM00074 は, 汚れの付着に関するパラメータで, 氷床上では TERM00075, その他
の場所では TERM00076 を与えている.

これを用いて積雪のアルベドは,
\begin{verbatim}
EQ=00044.
\end{verbatim}
により求める.
ここで TERM00077 は, 予報変数である TERM00078 から, 上
と同様の式により逆算して求めておいたものである.

降雪があった場合には, 降雪量に応じてアルベドが新雪の値に更新される.
\begin{verbatim}
EQ=00045.
\end{verbatim}
TERM00079 は, アルベドが完全に新雪の値に戻るのに必要な積雪量である. 
